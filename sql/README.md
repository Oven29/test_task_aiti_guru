## 1. Даталогическая схема данных

![datamodel](datamodel.png)

(Делал на сайте [nosqldbm](https://nosqldbm.ru/#/), туда можно загрузить `datamodel.xml` для просмотра и редактирования)

## 2. SQL-запросы

- 2.1. Получение информации о сумме товаров заказанных под каждого клиента (Наименование клиента, сумма)
`queries/2.1_get_sum.sql`

- 2.2. Найти количество дочерних элементов первого уровня вложенности для категорий номенклатуры.
`queries/2.2_get_childrens.sql`

- 2.3.1 Топ-5 самых покупаемых товаров за последний месяц
`queries/2.3_get_top.sql`

- 2.3.2 Запрос работает через рекурсию. 
    - Минусы:
        - Если будет большая вложенность категорий = долгое выполнение
        - Если было много заказов = большая выборка и долгая сортировка (тысячи заказов в день = миллионы строк за месяц)
    - Варианты оптимизации:
        - Добавить в `products` или в `categories` колонку `root_category_id`, чтобы не искать каждый раз по рекурсии
        - Можно сделать доп таблицу, в которой будет храниться товар, текущий месяц и год, и количество заказов,
            данные будут заноситься при каждом заказе

Для небольшого количества заказов и вложенности категорий с учётом обновления данных раз в месяц,
текущий запрос более чем подходит, несмотря на его сложность


Во все запросы можно добавить проверку статуса платежа, чтобы игнорировать отмененные заказы
```sql
...
WHERE
    o.status IN ('paid','shipped','completed')
...
```
